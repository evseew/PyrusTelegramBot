#!/usr/bin/env python3
"""
–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–∏–ª–∏–∞–ª–æ–≤ –î–û –∏ –ü–û–°–õ–ï –∏–∑–º–µ–Ω–µ–Ω–∏–π.
"""

import asyncio
import sys
from pathlib import Path
from dotenv import load_dotenv

load_dotenv()
sys.path.append(str(Path(__file__).parent / "app"))

from pyrus_excel_report import PyrusDataAnalyzer

async def compare_stats():
    """–°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ñ–∏–ª–∏–∞–ª–æ–≤ –î–û –∏ –ü–û–°–õ–ï –∏–∑–º–µ–Ω–µ–Ω–∏–π."""
    print("üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–∏–ª–∏–∞–ª–æ–≤...")
    
    analyzer = PyrusDataAnalyzer()
    await analyzer.analyze_form_2304918()
    await analyzer.analyze_form_792300()
    
    # –î–∞–Ω–Ω—ã–µ –î–û –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞)
    before_data = {
        "Online": {"2304918": 115, "792300": 50},
        "–ê–∫–∞–¥–µ–º: –ö–∞—à–∏—Ä–∏–Ω—ã—Ö, 131": {"2304918": 99, "792300": 66},
        "–ö–æ–ø–µ–π—Å–∫": {"2304918": 175, "792300": 66},
        "–õ–µ–Ω–∏–Ω—Å–∫–∏–π: –î–∑–µ—Ä–∂–∏–Ω—Å–∫–æ–≥–æ, 82": {"2304918": 215, "792300": 103},  # –ë—ã–ª–æ 220, –ø–æ—Ç–µ—Ä—è–ª–æ 5
        "–ü–∞—Ä–∫–æ–≤—ã–π: –ö—Ä–∞—Å–Ω–æ–ø–æ–ª—å—Å–∫–∏–π, 34": {"2304918": 227, "792300": 102},  # –ë—ã–ª–æ 253, –ø–æ—Ç–µ—Ä—è–ª–æ 26
        "–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥: –ö–∞—à–∏—Ä–∏–Ω—ã—Ö, 97": {"2304918": 254, "792300": 72},
        "–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥: –ß–∏—á–µ—Ä–∏–Ω–∞, 25–ë": {"2304918": 430, "792300": 140},  # –ë—ã–ª–æ 454, –ø–æ—Ç–µ—Ä—è–ª–æ 24
        "–¶–µ–Ω—Ç—Ä: –°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∏–π, 84–ë": {"2304918": 185, "792300": 60},     # –ë—ã–ª–æ 229 –∏ 69, –ø–æ—Ç–µ—Ä—è–ª–æ 44 –∏ 9
        "–ß–º–∑: –ë.–•–º–µ–ª—å–Ω–∏—Ü–∫–æ–≥–æ, 19": {"2304918": 110, "792300": 66},       # –ë—ã–ª–æ 196 –∏ 75, –ø–æ—Ç–µ—Ä—è–ª–æ 86 –∏ 9
        "–ß—Ç–∑: –ö–æ–º–∞—Ä–æ–≤–∞, 127–ê": {"2304918": 147, "792300": 64},           # –ë—ã–ª–æ 160, –ø–æ—Ç–µ—Ä—è–ª–æ 13
        "–ß—É—Ä–∏–ª–æ–≤–æ: –ó–∞–ª—å—Ü–º–∞–Ω–∞, 10": {"2304918": 123, "792300": 36},       # –ë—ã–ª–æ 164, –ø–æ—Ç–µ—Ä—è–ª–æ 41
    }
    
    print(f"\n{'–§–∏–ª–∏–∞–ª':<35} {'2304918 –î–û':<12} {'2304918 –ü–û–°–õ–ï':<15} {'–ü—Ä–∏—Ä–æ—Å—Ç':<10} {'792300 –î–û':<12} {'792300 –ü–û–°–õ–ï':<15} {'–ü—Ä–∏—Ä–æ—Å—Ç':<10}")
    print("-" * 130)
    
    total_gain_2304918 = 0
    total_gain_792300 = 0
    
    for branch_name, branch_stats in analyzer.branches_stats.items():
        # –î–∞–Ω–Ω—ã–µ –ü–û–°–õ–ï –∏–∑–º–µ–Ω–µ–Ω–∏–π
        after_2304918 = branch_stats.form_2304918_total
        after_792300 = branch_stats.form_792300_total
        
        # –î–∞–Ω–Ω—ã–µ –î–û –∏–∑–º–µ–Ω–µ–Ω–∏–π
        before_data_branch = before_data.get(branch_name, {"2304918": 0, "792300": 0})
        before_2304918 = before_data_branch["2304918"]
        before_792300 = before_data_branch["792300"]
        
        # –ü—Ä–∏—Ä–æ—Å—Ç
        gain_2304918 = after_2304918 - before_2304918
        gain_792300 = after_792300 - before_792300
        
        total_gain_2304918 += gain_2304918
        total_gain_792300 += gain_792300
        
        print(f"{branch_name:<35} {before_2304918:<12} {after_2304918:<15} {gain_2304918:+<10} {before_792300:<12} {after_792300:<15} {gain_792300:+<10}")
    
    print("-" * 130)
    print(f"{'–ò–¢–û–ì–û –ü–†–ò–†–û–°–¢:':<35} {'':<12} {'':<15} {total_gain_2304918:+<10} {'':<12} {'':<15} {total_gain_792300:+<10}")
    
    print(f"\n‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢:")
    print(f"–í—Å–µ —Ñ–∏–ª–∏–∞–ª—ã —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∏–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ —Å–≤–æ–∏ —Ñ–æ—Ä–º—ã!")
    print(f"–û–±—â–∏–π –ø—Ä–∏—Ä–æ—Å—Ç: {total_gain_2304918 + total_gain_792300} —Ñ–æ—Ä–º")
    print(f"–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ä–∞–Ω—å—à–µ {total_gain_2304918 + total_gain_792300} —Ñ–æ—Ä–º –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ –∏—Å–∫–ª—é—á–∞–ª–∏—Å—å –∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–∏–ª–∏–∞–ª–æ–≤.")

if __name__ == "__main__":
    asyncio.run(compare_stats())


