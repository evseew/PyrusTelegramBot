# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –≠—Ç–∞–ø–∞ 3 –Ω–∞ VPS

## –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è
‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ VPS (–ø–æ—Ä—Ç 8000)  
‚ùå –ó–∞–ø—É—â–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (–≠—Ç–∞–ø 1) - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `"webhook received"`  
üéØ –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ (–≠—Ç–∞–ø 3) - –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `"webhook processed"`  

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è VPS

### 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π API
```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω uvicorn –Ω–∞–∂–∞—Ç—å Ctrl+C
# –ò–ª–∏ –Ω–∞–π—Ç–∏ –∏ —É–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å:
sudo kill $(ps aux | grep 'uvicorn.*8000' | grep -v grep | awk '{print $2}')
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
```bash
cd ~/PyrusTelegramBot

# –í–∞—Ä–∏–∞–Ω—Ç A: –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è git
git pull origin main

# –í–∞—Ä–∏–∞–Ω—Ç B: –ï—Å–ª–∏ –∫–æ–¥ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
# - app/api.py (–æ—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
# - app/db.py  
# - app/models.py
# - app/utils.py
# - requirements.txt
```

### 3. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
pip3 install -r requirements.txt
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª
```bash
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è dev —Ä–µ–∂–∏–º–∞:
echo "DEV_SKIP_PYRUS_SIG=true" >> .env
```

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π API
```bash
uvicorn app.api:app --host 0.0.0.0 --port 8000 --reload
```

## –û–∂–∏–¥–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≠—Ç–∞–ø 1):
```json
{"status": "ok", "message": "webhook received"}
```

### –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≠—Ç–∞–ø 3):
```json
{"status": "ok", "message": "webhook processed"}
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
curl -s -X POST http://195.133.81.197:8000/pyrus/webhook \
  -H "Content-Type: application/json" \
  -d '{"event":"test","task":{"id":1}}'

# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: "webhook processed"
```

### –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
python3 test_vps_api.py
```

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

‚úÖ Health endpoint: `ok`  
‚úÖ –í–∞–ª–∏–¥–Ω—ã–π webhook: `"webhook processed"`  
‚úÖ –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON: HTTP 400  
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î Supabase  
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –∏ —Ä–µ–∞–∫—Ü–∏–π  

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ app/__init__.py —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
touch app/__init__.py
```

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
cat .env | grep SUPABASE
```

### –û—à–∏–±–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å supabase —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π
pip3 install supabase==1.0.3 websockets==11.0.3
```

---

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –≠—Ç–∞–ø 3 –∑–∞–≤–µ—Ä—à—ë–Ω! üöÄ**
